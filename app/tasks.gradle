//file:noinspection HttpUrlsUsage

tasks.register('bootstrapCIRole', Exec) {
    description 'Create the role for GoCD to assume'

    executable = 'aws'
    args = ['iam', 'create-role', '--role-name=ci-agent', '--assume-role-policy-document=file://ci-assume-role-policy.json']
}

tasks.register('attachPolicyToCIRole', Exec) {
    description 'Attach an inline policy to the ci-agent role'

    executable = 'aws'
    args = ['iam', 'put-role-policy', '--role-name=ci-agent', '--policy-name=ci-role-policy', '--policy-document=file://ci-role-policy.json']
}

tasks.register('e2eTest', Test) {
    group 'verification'
    description 'Run all end-to-end tests against LocalStack.'
    testClassesDirs = sourceSets.e2eTest.output.classesDirs
    classpath = sourceSets.e2eTest.runtimeClasspath
}
